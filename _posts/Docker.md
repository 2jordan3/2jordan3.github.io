---

layout: post

title: Docker

---
애플리케이션은 하드웨어, OS, 미들웨어 등 인프라 환경에 민감하게 반응할 때가 많습니다. 개발 환경과 테스트 환경에서는 동작을 잘 하다가 제품 환경에서는 동작하지 않는 경우도 있습니다. 
이럴 경우 고객사의 인프라, 보안 환경, 각종 OS 나 미들웨어의 버전 등 원인이 다양할 수 있어 찾기가 쉽지 않습니다.
도커는 애플리케이션 뿐만 아니라 실행에 필요한 시스템 환경을 모아서 컨테이너(Container)로 관리합니다. 이렇게 만든 것을 도커 이미지(Docker Image)라고 하는데 이 이미지로 만든 컨테이너는 도커가 설치된 곳이라면 어디든 똑같이 동작합니다. 
그곳이 Windows 든, macOS 든, Linux 든 상관이 없고 온프레미스(On-premise) 든 클라우드든 상관 없습니다.


## VM vs Docker Container

![](http://avilos.codes/wp-content/uploads/2018/04/Container-vs-VMs.jpg)

기존 가상화 기술은 하이퍼바이저를 이용하여 여러개의 운영체제를 하나의 호스트에서 생성하여 사용하는 방식.
하이퍼바이저에 의하여 생성되고 관리되는 운영체제는 게스트 운영체제라고하여 다른 게스트 운영체제와는 분리되어 독립된 공간과 시스템 자원을 할당받아 사용.
시스템 자원을 가상화하고 독립된 곡안을 생성하는 것은 안정성, 보안성 측면에서는 효율적.하지만 일반 호스트에 비하여 성능 손실발생
이미지로 배포시에는 용량이 커서 부담이 존재.\
도커 컨테이너는 가상화된 공산을 생성 시 프로세스 단위의 격리환경을 만들기 때문에 성능 손실이 거의 없음.
컨테이너는 애플리케이션을 구동하는데 필요한 라이브러리 및 실행파일만 존재. 호스트의 커널을 공유해 사용. 용량 적음.
시간이 빠르고 성능손실이 거의 없음.

## 도커의 기능

### Build - 이미지 만들기
도커는 애플리케이션과 실행에 필요한 라이브러리, 미들웨어, OS, 네트워크 설정 등 필요한 모든 파일을 모아서 도커 이미지로 만듭니다. 도커 이미지는 명령어를 이용해 수동으로 만들 수도 있지만 자동으로 빌드와 배포를 하는 CI/CD 환경에서는 도커 설정 파일(Dockerfile)을 이용해 자동으로 만들 수도 있습니다.
보통 이미지에는 하나의 애플리케이션만 넣고 여러 컨테이너를 조합해서 서비스를 구축하는 방법을 사용합니다. 또한 이미지를 여러 개 같이 사용할 수 있습니다. 예를 들면 CentOS 리눅스 이미지와 Nginx 웹 서버 이미지를 겹쳐서 새로운 이미지를 만들 수 있습니다.

### Ship - 이미지 공유
도커 이미지를 업로드해서 공유하는 저장소를 도커 레지스트리(Docker Registry)라고 합니다. 대표적으로는 도커의 공식 레지스트리인 Docker Hub 가 있습니다. 도커 허브에서는 업체에서 제공하는 공식 이미지를 받을 수 있습니다.[2] Ubuntu 나 CentOS 같은 OS 이미지, MySQL, Redis, MongoDB, Nginx 와 같은 미들웨어, OpenJDK, Golang, NodeJS 와 같은 플랫폼 이미지도 제공합니다.

이런 베이스 이미지를 활용하면 환경을 빠르고 안전하게, 그리고 자동으로 구축할 수 있습니다. 내가 만든 애플리케이션 또한 이미지로 만들어서 업로드하고 공유할 수 있습니다. Github 와 같은 형상관리툴과 연동해서 Dockerfile 을 관리하고 도커 이미지를 자동으로 빌드해서 도커 허브로 배포도 가능합니다.

### Run - 컨테이너 동작
도커는 도커 이미지를 가지고 컨테이너를 생성해서 동작시킵니다. 하나의 이미지를 가지고 여러 개의 컨테이너를 만들어낼 수도 있습니다. 도커는 컨테이너를 생성하고 관리하기 위한 여러 명령을 제공합니다.

실제 업무에서는 보통 한 대의 호스트에 모든 컨테이너를 동작시키는 것이 아니라 여러 호스트로 된 분산 환경인 경우가 많습니다. 이런 분산 환경에서 여러 노드의 컨테이너를 관리하기 위해 쿠버네티스(Kubernetes, k8s)와 같은 컨테이너 오케스트레이션 툴(Container Orchestration Tool)을 주로 사용합니다. 오케스트레이션이란 컨테이너 배포, 장애 복구, 로드 밸런싱 등 여러 기능을 자동으로 처리해주는 것을 말합니다.
